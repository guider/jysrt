"use strict";function t(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var e=require("stream"),r=t(require("multipipe")),s=t(require("split2")),n=t(require("strip-bom"));function i(){return(i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t}).apply(this,arguments)}var a=function(t,e){return void 0===e&&(e=2),t.toString().padStart(e,"0")},o=function(t){return new e.Duplex(i({objectMode:!0,autoDestroy:!1,read:function(){}},t))};function u(t,e){void 0===e&&(e={format:"SRT"});var r=new Date(0,0,0,0,0,0,t),s=r.getHours(),n=r.getMinutes(),i=r.getSeconds(),o=t-(36e5*s+6e4*n+1e3*i);return a(s)+":"+a(n)+":"+a(i)+("WebVTT"===e.format?".":",")+a(o,3)}var h=function(t){var r=0;return new e.Transform({objectMode:!0,autoDestroy:!1,transform:function(e,s,n){n(null,t(e,r++))}})};function f(t){var e=t.match(/^(?:(\d{1,}):)?(\d{2}):(\d{2})[,.](\d{3})$/);if(!e)throw new Error('Invalid SRT or VTT time format: "'+t+'"');return(e[1]?36e5*parseInt(e[1],10):0)+6e4*parseInt(e[2],10)+1e3*parseInt(e[3],10)+parseInt(e[4],10)}var p=/^((?:\d{1,}:)?\d{2}:\d{2}[,.]\d{3}) --> ((?:\d{1,}:)?\d{2}:\d{2}[,.]\d{3})(?: (.*))?$/;function d(t){var e=p.exec(t);if(!e)throw new Error("Invalid timestamp format");var r={start:f(e[1]),end:f(e[2])};return e[3]&&(r.settings=e[3]),r}var c=function(){function t(t){this.options=t,this.hasReceivedHeader=!1,this.isVTT="WebVTT"===t.format,this.index=1}var e=t.prototype;return e.format=function(t){var e="";return"header"===t.type&&this.isVTT&&(this.hasReceivedHeader=!0,e+=t.data+"\n\n"),"cue"===t.type&&(!this.hasReceivedHeader&&this.isVTT&&(this.hasReceivedHeader=!0,e+="WEBVTT\n\n"),e+=this.formatCue(t.data,this.index++,this.options)),e},e.formatCue=function(t,e,r){return[(e>1?"\n":"")+e,u(t.start,r)+" --\x3e "+u(t.end,r)+("WebVTT"===r.format&&t.settings?" "+t.settings:""),t.text,""].join("\n")},t}(),m=function(){function t(t){this.push=t.push,this.state={expect:"header",row:0,hasContentStarted:!1,isWebVTT:!1,node:{},buffer:[]}}var e=t.prototype;return e.isIndex=function(t){return/^\d+$/.test(t.trim())},e.isTimestamp=function(t){return p.test(t)},e.getError=function(t,e,r){return new Error("expected "+t+" at row "+(e+1)+', but received: "'+r+'"')},e.parseLine=function(t){var e=0===this.state.row?n(t):t;if(!this.state.hasContentStarted){if(!e.trim())return;this.state.hasContentStarted=!0}({header:this.parseHeader,id:this.parseId,timestamp:this.parseTimestamp,text:this.parseText})[this.state.expect].call(this,e),this.state.row++},e.flush=function(){this.state.buffer.length>0&&this.pushNode()},e.parseHeader=function(t){if(!this.state.isWebVTT){if(this.state.isWebVTT=/^WEBVTT/.test(t),!this.state.isWebVTT)return void this.parseId(t);this.state.node.type="header"}this.state.buffer.push(t),t||(this.state.expect="id")},e.parseId=function(t){this.state.expect="timestamp","header"===this.state.node.type&&this.pushNode(),this.isIndex(t)||this.parseTimestamp(t)},e.parseTimestamp=function(t){if(!this.isTimestamp(t))throw this.getError("timestamp",this.state.row,t);this.state.node={type:"cue",data:i({},d(t),{text:""})},this.state.expect="text"},e.parseText=function(t){this.state.buffer.length>0&&this.isTimestamp(t)?(this.isIndex(this.state.buffer[this.state.buffer.length-1])&&this.state.buffer.pop(),this.pushNode(),this.parseTimestamp(t)):this.state.buffer.push(t)},e.pushNode=function(){if("cue"===this.state.node.type){for(;["","\n"].includes(this.state.buffer[this.state.buffer.length-1]);)this.state.buffer.pop();for(;["","\n"].includes(this.state.buffer[0]);)this.state.buffer.shift();this.state.node.data.text=this.state.buffer.join("\n")}"header"===this.state.node.type&&(this.state.node.data=this.state.buffer.join("\n").trim()),this.push(this.state.node),this.state.node={},this.state.buffer=[]},t}();exports.RE_TIMESTAMP=p,exports.filter=function(t){return o({write:function(e,r,s){t(e)&&this.push(e),s()}})},exports.formatTimestamp=u,exports.map=h,exports.parse=function(){var t=new m({push:function(t){return i.push(t)}}),e=o({write:function(e,r,s){try{t.parseLine(e.toString())}catch(t){return s(t)}s()}}),n=s();n.on("finish",(function(){t.flush(),e.push(null)}));var i=r(n,e,{objectMode:!0});return i},exports.parseSync=function(t){var e=[],r=new m({push:function(t){return e.push(t)}});return t.replace(/\r\n/g,"\n").split("\n").forEach((function(t){return r.parseLine(t)})),r.flush(),e},exports.parseTimestamp=f,exports.parseTimestamps=d,exports.resync=function(t){return h((function(e){return"cue"===e.type?i({},e,{data:i({},e.data,{start:e.data.start+t,end:e.data.end+t})}):e}))},exports.stringify=function(t){var e=new c(t);return h((function(t){return e.format(t)}))},exports.stringifySync=function(t,e){var r=new c(e);return t.reduce((function(t,e){return t+r.format(e)}),"")};
//# sourceMappingURL=subtitle.cjs.production.min.js.map
